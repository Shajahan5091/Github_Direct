version: 2
models:
  - name: dim_address
    description: Dimension table containing customer address information with standardized formatting
    columns:
      - name: address_id
        description: Unique identifier for each address record
        tests:
          - unique
          - not_null
      - name: customer_id
        description: Foreign key reference to customer dimension
        tests:
          - not_null
          - relationships:
              to: ref('dim_customer')
              field: customer_id
      - name: address_line1
        description: Primary address line with trimmed whitespace
        tests:
          - not_null
      - name: city
        description: City name in uppercase format
        tests:
          - not_null
      - name: country
        description: Country name
        tests:
          - not_null
      - name: last_updated
        description: Timestamp when the record was last updated
        tests:
          - not_null

  - name: dim_category
    description: Dimension table for product categories with hierarchical structure
    columns:
      - name: category_id
        description: Unique identifier for each category
        tests:
          - unique
          - not_null
      - name: category_name
        description: Category name in title case format
        tests:
          - not_null
      - name: parent_category_id
        description: Reference to parent category for hierarchical structure
        tests:
          - relationships:
              to: ref('dim_category')
              field: category_id
      - name: category_path
        description: Full hierarchical path showing parent and current category
        tests:
          - not_null
      - name: is_active
        description: Boolean flag indicating if category is currently active
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
      - name: last_updated
        description: Timestamp when the record was last updated
        tests:
          - not_null

  - name: dim_customer
    description: Customer dimension table with standardized names and derived tier information
    columns:
      - name: customer_id
        description: Unique identifier for each customer
        tests:
          - unique
          - not_null
      - name: first_name
        description: Customer first name in uppercase format
        tests:
          - not_null
      - name: last_name
        description: Customer last name in uppercase format
        tests:
          - not_null
      - name: email
        description: Customer email address in lowercase format
        tests:
          - not_null
          - unique
          - dbt_utils.accepted_range:
              min_value: 1
              inclusive: true
      - name: customer_since_date
        description: Date when customer first registered
        tests:
          - not_null
      - name: customer_tier
        description: Spending tier based on last 365 days (Gold/Silver/Bronze)
        tests:
          - not_null
          - accepted_values:
              values: ['Gold', 'Silver', 'Bronze']
      - name: last_updated
        description: Timestamp when the record was last updated
        tests:
          - not_null

  - name: dim_product
    description: Product dimension table with pricing information and categorization
    columns:
      - name: product_id
        description: Unique identifier for each product
        tests:
          - unique
          - not_null
      - name: product_name
        description: Product name in title case format
        tests:
          - not_null
      - name: price
        description: Product price with 2 decimal precision
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: price_band
        description: Price category bucket (Low/Mid/High/Premium)
        tests:
          - not_null
          - accepted_values:
              values: ['Low', 'Mid', 'High', 'Premium']
      - name: last_updated
        description: Timestamp when the record was last updated
        tests:
          - not_null

  - name: dim_supplier
    description: Supplier dimension table with contact and location information
    columns:
      - name: supplier_id
        description: Unique identifier for each supplier
        tests:
          - unique
          - not_null
      - name: supplier_name
        description: Supplier name in title case format
        tests:
          - not_null
      - name: contact_email
        description: Supplier contact email in lowercase format
        tests:
          - not_null
      - name: country
        description: Supplier country in uppercase format
        tests:
          - not_null
      - name: is_active
        description: Boolean flag indicating if supplier is currently active
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
      - name: last_updated
        description: Timestamp when the record was last updated
        tests:
          - not_null

  - name: fact_inventory
    description: Inventory fact table tracking stock levels by product and supplier
    columns:
      - name: product_id
        description: Foreign key reference to product dimension
        tests:
          - not_null
          - relationships:
              to: ref('dim_product')
              field: product_id
      - name: supplier_id
        description: Foreign key reference to supplier dimension
        tests:
          - not_null
          - relationships:
              to: ref('dim_supplier')
              field: supplier_id
      - name: stock_qty
        description: Current stock quantity
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: true
      - name: warehouse_location
        description: Warehouse location in uppercase format
        tests:
          - not_null
      - name: snapshot_date
        description: Date of inventory snapshot
        tests:
          - not_null
      - name: is_latest
        description: Flag indicating latest record per product and supplier
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
      - name: last_updated
        description: Timestamp when the record was last updated
        tests:
          - not_null

  - name: fact_order
    description: Order fact table containing order header information
    columns:
      - name: order_id
        description: Unique identifier for each order
        tests:
          - unique
          - not_null
      - name: customer_id
        description: Foreign key reference to customer dimension
        tests:
          - not_null
          - relationships:
              to: ref('dim_customer')
              field: customer_id
      - name: order_date
        description: Date when order was placed
        tests:
          - not_null
      - name: order_status
        description: Current order status in uppercase format
        tests:
          - not_null
          - accepted_values:
              values: ['PENDING', 'CANCELLED', 'SHIPPED', 'DELIVERED']
      - name: total_amount
        description: Total order amount with 2 decimal precision
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: last_updated
        description: Timestamp when the record was last updated
        tests:
          - not_null

  - name: fact_order_item
    description: Order line item fact table with calculated amounts
    columns:
      - name: order_item_id
        description: Unique identifier for each order line item
        tests:
          - unique
          - not_null
      - name: order_id
        description: Foreign key reference to order fact table
        tests:
          - not_null
          - relationships:
              to: ref('fact_order')
              field: order_id
      - name: product_id
        description: Foreign key reference to product dimension
        tests:
          - not_null
          - relationships:
              to: ref('dim_product')
              field: product_id
      - name: quantity
        description: Quantity of product ordered
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
              inclusive: true
      - name: unit_price
        description: Price per unit with 2 decimal precision
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: extended_amount
        description: Calculated amount (quantity * unit_price)
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: discount_amount
        description: Allocated discount amount with 2 decimal precision
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: true
      - name: net_amount
        description: Final amount after discount (extended_amount - discount_amount)
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: last_updated
        description: Timestamp when the record was last updated
        tests:
          - not_null

  - name: fact_payment
    description: Payment fact table tracking order payments by method
    columns:
      - name: payment_id
        description: Unique identifier for each payment transaction
        tests:
          - unique
          - not_null
      - name: order_id
        description: Foreign key reference to order fact table
        tests:
          - not_null
          - relationships:
              to: ref('fact_order')
              field: order_id
      - name: payment_date
        description: Date when payment was processed
        tests:
          - not_null
      - name: payment_method
        description: Payment method in uppercase format
        tests:
          - not_null
          - accepted_values:
              values: ['CARD', 'UPI', 'COD', 'NETBANKING']
      - name: amount
        description: Payment amount with 2 decimal precision
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: is_fully_applied
        description: Flag indicating if total payments cover order amount
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
      - name: last_updated
        description: Timestamp when the record was last updated
        tests:
          - not_null

  - name: fact_shipment
    description: Shipment fact table tracking order delivery information
    columns:
      - name: shipment_id
        description: Unique identifier for each shipment
        tests:
          - unique
          - not_null
      - name: order_id
        description: Foreign key reference to order fact table
        tests:
          - not_null
          - relationships:
              to: ref('fact_order')
              field: order_id
      - name: shipped_date
        description: Date when order was shipped
        tests:
          - not_null
      - name: days_to_ship
        description: Number of days between order and shipment
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: true
      - name: carrier
        description: Shipping carrier name in uppercase format
        tests:
          - not_null
      - name: tracking_number
        description: Shipment tracking number
        tests:
          - not_null
      - name: last_updated
        description: Timestamp when the record was last updated
        tests:
          - not_null