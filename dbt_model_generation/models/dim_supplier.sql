{#
------------------------------------------------------------------------
MODEL NAME    : dim_supplier
TARGET TABLE  : BSL_MA.DWH_MA.DIM_SUPPLIER
SOURCE TABLES : BSL_RAW.DWH_RAW.SUPPLIERS
DESCRIPTION   : Dimension table for suppliers containing supplier information
                including ID, name, contact details, country, and active status
PREREQUISITES : Source table SUPPLIERS must exist in BSL_RAW.DWH_RAW schema
PARAMETER     : None
AUTHOUR       : AI Generated by Shajahan - 2025-11-20
------------------------------------------------------------------------
#}

{{ config(materialized='table') }}

with source_suppliers as (
    select
        supplier_id,
        supplier_name,
        contact_email,
        country,
        active_flag
    from {{ source('dwh_raw', 'suppliers') }}
),

transformed_suppliers as (
    select
        suppliers.supplier_id,
        trim(initcap(suppliers.supplier_name)) as supplier_name,
        case 
            when suppliers.contact_email regexp '^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\\.[A-Za-z]{2,}$' 
            then lower(suppliers.contact_email)
            else null
        end as contact_email,
        upper(suppliers.country) as country,
        coalesce(suppliers.active_flag, false) as is_active
    from source_suppliers as suppliers
)

select * from transformed_suppliers