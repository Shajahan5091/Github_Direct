version: 2

models:
  - name: dim_address
    description: "Dimension table containing customer address information"
    columns:
      - name: address_id
        description: "Unique identifier for each address"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: customer_id
        description: "Foreign key to customer dimension"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('dim_customer')
              field: customer_id
      - name: address_line1
        description: "Primary address line with whitespace trimmed"
        data_type: varchar
        tests:
          - not_null
      - name: city
        description: "City name in uppercase format"
        data_type: varchar
        tests:
          - not_null
      - name: country
        description: "Country name"
        data_type: varchar
        tests:
          - not_null
      - name: inserted_at
        description: "Date when address record was inserted"
        data_type: date
        tests:
          - not_null

  - name: dim_category
    description: "Dimension table containing product category information"
    columns:
      - name: category_id
        description: "Unique identifier for each category"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: category_name
        description: "Category name in title case format"
        data_type: varchar
        tests:
          - not_null
      - name: parent_category_id
        description: "Foreign key to parent category"
        data_type: varchar
      - name: category_path
        description: "Hierarchical path showing parent and current category"
        data_type: varchar
        tests:
          - not_null
      - name: is_active
        description: "Flag indicating if category is active"
        data_type: boolean
        tests:
          - not_null

  - name: dim_customer
    description: "Dimension table containing customer information"
    columns:
      - name: customer_id
        description: "Unique identifier for each customer"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: first_name
        description: "Customer first name in uppercase format"
        data_type: varchar
        tests:
          - not_null
      - name: last_name
        description: "Customer last name in uppercase format"
        data_type: varchar
        tests:
          - not_null
      - name: email
        description: "Customer email address in lowercase format"
        data_type: varchar
        tests:
          - not_null
          - unique
          - dbt_utils.accepted_values:
              values: ['@']
              quote: false
      - name: customer_since_date
        description: "Date when customer first registered"
        data_type: date
        tests:
          - not_null
      - name: customer_tier
        description: "Customer spending tier based on last 365 days"
        data_type: varchar
        tests:
          - not_null
          - accepted_values:
              values: ['Gold', 'Silver', 'Bronze']

  - name: dim_product
    description: "Dimension table containing product information"
    columns:
      - name: product_id
        description: "Unique identifier for each product"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: product_name
        description: "Product name in title case format"
        data_type: varchar
        tests:
          - not_null
      - name: price
        description: "Product price"
        data_type: number
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: price_band
        description: "Price category bucket"
        data_type: varchar
        tests:
          - not_null
          - accepted_values:
              values: ['Low', 'Mid', 'High', 'Premium']

  - name: dim_supplier
    description: "Dimension table containing supplier information"
    columns:
      - name: supplier_id
        description: "Unique identifier for each supplier"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: supplier_name
        description: "Supplier name in title case format"
        data_type: varchar
        tests:
          - not_null
      - name: contact_email
        description: "Supplier contact email in lowercase format"
        data_type: varchar
        tests:
          - not_null
      - name: country
        description: "Supplier country in uppercase format"
        data_type: varchar
        tests:
          - not_null
      - name: is_active
        description: "Flag indicating if supplier is active"
        data_type: boolean
        tests:
          - not_null

  - name: fact_inventory
    description: "Fact table containing inventory information"
    columns:
      - name: product_id
        description: "Foreign key to product dimension"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('dim_product')
              field: product_id
      - name: supplier_id
        description: "Foreign key to supplier dimension"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('dim_supplier')
              field: supplier_id
      - name: stock_qty
        description: "Current stock quantity"
        data_type: number
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: true
      - name: warehouse_location
        description: "Warehouse location in uppercase format"
        data_type: varchar
        tests:
          - not_null
      - name: snapshot_date
        description: "Date of inventory snapshot"
        data_type: date
        tests:
          - not_null
      - name: is_latest
        description: "Flag indicating latest record per product and supplier"
        data_type: boolean
        tests:
          - not_null

  - name: fact_order
    description: "Fact table containing order information"
    columns:
      - name: order_id
        description: "Unique identifier for each order"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: customer_id
        description: "Foreign key to customer dimension"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('dim_customer')
              field: customer_id
      - name: order_date
        description: "Date when order was placed"
        data_type: date
        tests:
          - not_null
      - name: order_status
        description: "Current status of the order"
        data_type: varchar
        tests:
          - not_null
          - accepted_values:
              values: ['PENDING', 'CANCELLED', 'SHIPPED', 'DELIVERED']
      - name: total_amount
        description: "Total order amount"
        data_type: number
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false

  - name: fact_order_item
    description: "Fact table containing order item details"
    columns:
      - name: order_item_id
        description: "Unique identifier for each order item"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: order_id
        description: "Foreign key to order fact table"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('fact_order')
              field: order_id
      - name: product_id
        description: "Foreign key to product dimension"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('dim_product')
              field: product_id
      - name: quantity
        description: "Quantity of product ordered"
        data_type: number
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: unit_price
        description: "Price per unit of product"
        data_type: number
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: extended_amount
        description: "Total amount for line item (quantity * unit_price)"
        data_type: number
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: discount_amount
        description: "Discount amount allocated to this line item"
        data_type: number
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: true
      - name: net_amount
        description: "Net amount after discount (extended_amount - discount_amount)"
        data_type: number
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false

  - name: fact_payment
    description: "Fact table containing payment information"
    columns:
      - name: payment_id
        description: "Unique identifier for each payment"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: order_id
        description: "Foreign key to order fact table"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('fact_order')
              field: order_id
      - name: payment_date
        description: "Date when payment was made"
        data_type: date
        tests:
          - not_null
      - name: payment_method
        description: "Method used for payment"
        data_type: varchar
        tests:
          - not_null
          - accepted_values:
              values: ['CARD', 'UPI', 'COD', 'NETBANKING']
      - name: amount
        description: "Payment amount"
        data_type: number
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: is_fully_applied
        description: "Flag indicating if total payments cover order amount"
        data_type: boolean
        tests:
          - not_null

  - name: fact_shipment
    description: "Fact table containing shipment information"
    columns:
      - name: shipment_id
        description: "Unique identifier for each shipment"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: order_id
        description: "Foreign key to order fact table"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('fact_order')
              field: order_id
      - name: shipped_date
        description: "Date when order was shipped"
        data_type: date
        tests:
          - not_null
      - name: days_to_ship
        description: "Number of days between order and shipment"
        data_type: number
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: true
      - name: carrier
        description: "Shipping carrier in uppercase format"
        data_type: varchar
        tests:
          - not_null
      - name: tracking_number
        description: "Shipment tracking number"
        data_type: varchar
        tests:
          - not_null