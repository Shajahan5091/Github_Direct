version: 2

models:
  - name: dim_address
    description: "Dimension table containing customer address information with standardized formatting"
    columns:
      - name: address_id
        description: "Unique identifier for each address record"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: customer_id
        description: "Foreign key reference to customer dimension"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('dim_customer')
              field: customer_id
      - name: address_line1
        description: "Primary address line with whitespace trimmed"
        data_type: varchar
        tests:
          - not_null
      - name: city
        description: "City name in uppercase format"
        data_type: varchar
        tests:
          - not_null
      - name: country
        description: "Country name"
        data_type: varchar
        tests:
          - not_null
      - name: inserted_at
        description: "Date when address record was created"
        data_type: date
        tests:
          - not_null

  - name: dim_category
    description: "Product category dimension with hierarchical structure"
    columns:
      - name: category_id
        description: "Unique identifier for each category"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: category_name
        description: "Category name in title case format"
        data_type: varchar
        tests:
          - not_null
      - name: parent_category_id
        description: "Reference to parent category for hierarchy"
        data_type: varchar
        tests:
          - relationships:
              to: ref('dim_category')
              field: category_id
      - name: category_path
        description: "Full hierarchical path showing parent and child categories"
        data_type: varchar
      - name: is_active
        description: "Flag indicating if category is currently active"
        data_type: boolean
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

  - name: dim_customer
    description: "Customer dimension with derived tier information"
    columns:
      - name: customer_id
        description: "Unique identifier for each customer"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: first_name
        description: "Customer first name in uppercase"
        data_type: varchar
        tests:
          - not_null
      - name: last_name
        description: "Customer last name in uppercase"
        data_type: varchar
        tests:
          - not_null
      - name: email
        description: "Customer email address in lowercase"
        data_type: varchar
        tests:
          - not_null
          - unique
          - dbt_utils.accepted_range:
              min_value: 1
              inclusive: false
              where: "email like '%@%'"
      - name: customer_since_date
        description: "Date when customer first registered"
        data_type: date
        tests:
          - not_null
      - name: customer_tier
        description: "Customer spending tier based on last 365 days activity"
        data_type: varchar
        tests:
          - accepted_values:
              values: ['Gold', 'Silver', 'Bronze']

  - name: dim_product
    description: "Product dimension with price banding"
    columns:
      - name: product_id
        description: "Unique identifier for each product"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: product_name
        description: "Product name in title case"
        data_type: varchar
        tests:
          - not_null
      - name: price
        description: "Product price"
        data_type: number
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: price_band
        description: "Price category bucket (Low/Mid/High/Premium)"
        data_type: varchar
        tests:
          - not_null
          - accepted_values:
              values: ['Low', 'Mid', 'High', 'Premium']

  - name: dim_supplier
    description: "Supplier dimension with contact information"
    columns:
      - name: supplier_id
        description: "Unique identifier for each supplier"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: supplier_name
        description: "Supplier name in title case"
        data_type: varchar
        tests:
          - not_null
      - name: contact_email
        description: "Supplier contact email in lowercase"
        data_type: varchar
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 1
              inclusive: false
              where: "contact_email like '%@%'"
      - name: country
        description: "Supplier country in uppercase"
        data_type: varchar
        tests:
          - not_null
      - name: is_active
        description: "Flag indicating if supplier is currently active"
        data_type: boolean
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

  - name: fact_inventory
    description: "Inventory fact table with product stock levels by supplier and location"
    columns:
      - name: product_id
        description: "Foreign key to product dimension"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('dim_product')
              field: product_id
      - name: supplier_id
        description: "Foreign key to supplier dimension"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('dim_supplier')
              field: supplier_id
      - name: stock_qty
        description: "Current stock quantity"
        data_type: number
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: true
      - name: warehouse_location
        description: "Warehouse location in uppercase"
        data_type: varchar
        tests:
          - not_null
      - name: snapshot_date
        description: "Date of inventory snapshot"
        data_type: date
        tests:
          - not_null
      - name: is_latest
        description: "Flag indicating latest record per product-supplier combination"
        data_type: boolean
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

  - name: fact_order
    description: "Order fact table with customer and order details"
    columns:
      - name: order_id
        description: "Unique identifier for each order"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: customer_id
        description: "Foreign key to customer dimension"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('dim_customer')
              field: customer_id
      - name: order_date
        description: "Date when order was placed"
        data_type: date
        tests:
          - not_null
      - name: order_status
        description: "Current status of the order"
        data_type: varchar
        tests:
          - not_null
          - accepted_values:
              values: ['PENDING', 'CANCELLED', 'SHIPPED', 'DELIVERED']
      - name: total_amount
        description: "Total order amount"
        data_type: number
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false

  - name: fact_order_item
    description: "Order line item fact table with product details and calculations"
    columns:
      - name: order_item_id
        description: "Unique identifier for each order line item"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: order_id
        description: "Foreign key to order fact table"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('fact_order')
              field: order_id
      - name: product_id
        description: "Foreign key to product dimension"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('dim_product')
              field: product_id
      - name: quantity
        description: "Quantity of product ordered"
        data_type: number
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: unit_price
        description: "Price per unit of product"
        data_type: number
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: extended_amount
        description: "Calculated amount (quantity * unit_price)"
        data_type: number
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: discount_amount
        description: "Proportionally allocated discount amount"
        data_type: number
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: true
      - name: net_amount
        description: "Final amount after discount (extended_amount - discount_amount)"
        data_type: number
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false

  - name: fact_payment
    description: "Payment fact table with payment method and application status"
    columns:
      - name: payment_id
        description: "Unique identifier for each payment"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: order_id
        description: "Foreign key to order fact table"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('fact_order')
              field: order_id
      - name: payment_date
        description: "Date when payment was made"
        data_type: date
        tests:
          - not_null
      - name: payment_method
        description: "Method used for payment"
        data_type: varchar
        tests:
          - not_null
          - accepted_values:
              values: ['CARD', 'UPI', 'COD', 'NETBANKING']
      - name: amount
        description: "Payment amount"
        data_type: number
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: false
      - name: is_fully_applied
        description: "Flag indicating if total payments cover order amount"
        data_type: boolean
        tests:
          - not_null
          - accepted_values:
              values: [true, false]

  - name: fact_shipment
    description: "Shipment fact table with carrier and timing information"
    columns:
      - name: shipment_id
        description: "Unique identifier for each shipment"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: order_id
        description: "Foreign key to order fact table"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('fact_order')
              field: order_id
      - name: shipped_date
        description: "Date when order was shipped"
        data_type: date
        tests:
          - not_null
      - name: days_to_ship
        description: "Number of days between order and shipment"
        data_type: number
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: 0
              inclusive: true
      - name: carrier
        description: "Shipping carrier in uppercase"
        data_type: varchar
        tests:
          - not_null
      - name: tracking_number
        description: "Shipment tracking number"
        data_type: varchar
        tests:
          - not_null