version: 2

models:
  - name: dim_address
    description: "Dimension table containing customer address information with standardized formatting"
    columns:
      - name: address_id
        description: "Unique identifier for each address record"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: customer_id
        description: "Foreign key reference to customer dimension"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('dim_customer')
              field: customer_id
      - name: address_line1
        description: "Primary address line with whitespace trimmed"
        data_type: varchar
        tests:
          - not_null
          - dbt_utils.not_empty_string
      - name: city
        description: "City name in uppercase format"
        data_type: varchar
        tests:
          - not_null
          - dbt_utils.not_empty_string
      - name: country
        description: "Country name"
        data_type: varchar
        tests:
          - not_null
          - dbt_utils.not_empty_string
      - name: last_updated
        description: "Timestamp when the record was last updated"
        data_type: timestamp
        tests:
          - not_null

  - name: dim_category
    description: "Dimension table for product categories with hierarchical path structure"
    columns:
      - name: category_id
        description: "Unique identifier for each category"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: category_name
        description: "Category name in title case format"
        data_type: varchar
        tests:
          - not_null
          - dbt_utils.not_empty_string
      - name: parent_category_id
        description: "Reference to parent category for hierarchy"
        data_type: varchar
      - name: category_path
        description: "Full hierarchical path up to 2 levels"
        data_type: varchar
        tests:
          - not_null
      - name: is_active
        description: "Flag indicating if category is currently active"
        data_type: boolean
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
      - name: last_updated
        description: "Timestamp when the record was last updated"
        data_type: timestamp
        tests:
          - not_null

  - name: dim_customer
    description: "Customer dimension with standardized names and derived tier information"
    columns:
      - name: customer_id
        description: "Unique identifier for each customer"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: first_name
        description: "Customer first name in uppercase"
        data_type: varchar
        tests:
          - not_null
          - dbt_utils.not_empty_string
      - name: last_name
        description: "Customer last name in uppercase"
        data_type: varchar
        tests:
          - not_null
          - dbt_utils.not_empty_string
      - name: email
        description: "Customer email in lowercase for consistency"
        data_type: varchar
        tests:
          - not_null
          - dbt_utils.not_empty_string
          - unique
      - name: customer_since_date
        description: "Date when customer first registered"
        data_type: date
        tests:
          - not_null
      - name: customer_tier
        description: "Spending tier based on last 365 days (Gold/Silver/Bronze)"
        data_type: varchar
        tests:
          - not_null
          - accepted_values:
              values: ['Gold', 'Silver', 'Bronze']
      - name: last_updated
        description: "Timestamp when the record was last updated"
        data_type: timestamp
        tests:
          - not_null

  - name: dim_product
    description: "Product dimension with pricing information and categorization"
    columns:
      - name: product_id
        description: "Unique identifier for each product"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: product_name
        description: "Product name in title case"
        data_type: varchar
        tests:
          - not_null
          - dbt_utils.not_empty_string
      - name: price
        description: "Product price"
        data_type: number
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: price_band
        description: "Price category (Low/Mid/High/Premium)"
        data_type: varchar
        tests:
          - not_null
          - accepted_values:
              values: ['Low', 'Mid', 'High', 'Premium']
      - name: last_updated
        description: "Timestamp when the record was last updated"
        data_type: timestamp
        tests:
          - not_null

  - name: dim_supplier
    description: "Supplier dimension with contact information and status"
    columns:
      - name: supplier_id
        description: "Unique identifier for each supplier"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: supplier_name
        description: "Supplier name in title case"
        data_type: varchar
        tests:
          - not_null
          - dbt_utils.not_empty_string
      - name: contact_email
        description: "Supplier contact email in lowercase"
        data_type: varchar
        tests:
          - not_null
          - dbt_utils.not_empty_string
      - name: country
        description: "Supplier country in uppercase"
        data_type: varchar
        tests:
          - not_null
          - dbt_utils.not_empty_string
      - name: is_active
        description: "Flag indicating if supplier is currently active"
        data_type: boolean
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
      - name: last_updated
        description: "Timestamp when the record was last updated"
        data_type: timestamp
        tests:
          - not_null

  - name: fact_inventory
    description: "Inventory fact table with stock quantities and warehouse locations"
    columns:
      - name: product_id
        description: "Foreign key reference to product dimension"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('dim_product')
              field: product_id
      - name: supplier_id
        description: "Foreign key reference to supplier dimension"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('dim_supplier')
              field: supplier_id
      - name: stock_qty
        description: "Current stock quantity"
        data_type: number
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: warehouse_location
        description: "Warehouse location in uppercase"
        data_type: varchar
        tests:
          - not_null
          - dbt_utils.not_empty_string
      - name: snapshot_date
        description: "Date of inventory snapshot"
        data_type: date
        tests:
          - not_null
      - name: is_latest
        description: "Flag indicating latest record per product and supplier"
        data_type: boolean
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
      - name: last_updated
        description: "Timestamp when the record was last updated"
        data_type: timestamp
        tests:
          - not_null

  - name: fact_order
    description: "Order fact table with customer orders and status information"
    columns:
      - name: order_id
        description: "Unique identifier for each order"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: customer_id
        description: "Foreign key reference to customer dimension"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('dim_customer')
              field: customer_id
      - name: order_date
        description: "Date when order was placed"
        data_type: date
        tests:
          - not_null
      - name: order_status
        description: "Normalized order status"
        data_type: varchar
        tests:
          - not_null
          - accepted_values:
              values: ['PENDING', 'CANCELLED', 'SHIPPED', 'DELIVERED']
      - name: total_amount
        description: "Total order amount"
        data_type: number
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: last_updated
        description: "Timestamp when the record was last updated"
        data_type: timestamp
        tests:
          - not_null

  - name: fact_order_item
    description: "Order line items with pricing and calculated amounts"
    columns:
      - name: order_item_id
        description: "Unique identifier for each order item"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: order_id
        description: "Foreign key reference to order fact"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('fact_order')
              field: order_id
      - name: product_id
        description: "Foreign key reference to product dimension"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('dim_product')
              field: product_id
      - name: quantity
        description: "Quantity of items ordered"
        data_type: number
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: "> 0"
      - name: unit_price
        description: "Price per unit"
        data_type: number
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: extended_amount
        description: "Calculated amount (quantity * unit_price)"
        data_type: number
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: discount_amount
        description: "Proportionally allocated discount amount"
        data_type: number
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: net_amount
        description: "Net amount after discount (extended_amount - discount_amount)"
        data_type: number
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: last_updated
        description: "Timestamp when the record was last updated"
        data_type: timestamp
        tests:
          - not_null

  - name: fact_payment
    description: "Payment transactions with method and application status"
    columns:
      - name: payment_id
        description: "Unique identifier for each payment"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: order_id
        description: "Foreign key reference to order fact"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('fact_order')
              field: order_id
      - name: payment_date
        description: "Date when payment was made"
        data_type: date
        tests:
          - not_null
      - name: payment_method
        description: "Standardized payment method"
        data_type: varchar
        tests:
          - not_null
          - accepted_values:
              values: ['CARD', 'UPI', 'COD', 'NETBANKING']
      - name: amount
        description: "Payment amount"
        data_type: number
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: "> 0"
      - name: is_fully_applied
        description: "Flag indicating if total payments cover order amount"
        data_type: boolean
        tests:
          - not_null
          - accepted_values:
              values: [true, false]
      - name: last_updated
        description: "Timestamp when the record was last updated"
        data_type: timestamp
        tests:
          - not_null

  - name: fact_shipment
    description: "Shipment tracking with delivery metrics and carrier information"
    columns:
      - name: shipment_id
        description: "Unique identifier for each shipment"
        data_type: varchar
        tests:
          - not_null
          - unique
      - name: order_id
        description: "Foreign key reference to order fact"
        data_type: varchar
        tests:
          - not_null
          - relationships:
              to: ref('fact_order')
              field: order_id
      - name: shipped_date
        description: "Date when shipment was dispatched"
        data_type: date
        tests:
          - not_null
      - name: days_to_ship
        description: "Number of days between order and shipment"
        data_type: number
        tests:
          - not_null
          - dbt_utils.expression_is_true:
              expression: ">= 0"
      - name: carrier
        description: "Shipping carrier in uppercase"
        data_type: varchar
        tests:
          - not_null
          - dbt_utils.not_empty_string
      - name: tracking_number
        description: "Shipment tracking number"
        data_type: varchar
        tests:
          - not_null
          - dbt_utils.not_empty_string
          - unique
      - name: last_updated
        description: "Timestamp when the record was last updated"
        data_type: timestamp
        tests:
          - not_null